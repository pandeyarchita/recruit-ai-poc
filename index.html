<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recruit-AI – Screening POC</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f7f7fb; margin:0; padding:0; }
    .container { max-width: 900px; margin: 40px auto; background:#fff; padding:24px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.08); }
    h1 { margin-top:0; }
    textarea, input[type=file] { width:100%; margin:10px 0; padding:12px; border-radius:8px; border:1px solid #ccc; }
    button { padding:12px 20px; border:none; border-radius:8px; background:#4f46e5; color:#fff; font-size:16px; cursor:pointer; }
    button:disabled { background:#999; }
    .results { margin-top:24px; padding:16px; background:#f1f5f9; border-radius:10px; }
    .badge { display:inline-block; padding:6px 10px; border-radius:999px; background:#e0e7ff; color:#3730a3; font-weight:bold; }
    ul { margin:8px 0; }
    .error { color: red; font-weight: bold; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Recruit-AI – Resume Screening Demo</h1>
    <p>Upload a Job Description and a Resume PDF to see the AI recruiter’s analysis.</p>

    <label><strong>Job Description</strong></label>
    <textarea id="jd" rows="6" placeholder="Paste the Job Description here..."></textarea>

    <label><strong>Resume (Upload PDF)</strong></label>
    <input type="file" id="resumeFile" accept=".pdf" />

    <button id="analyzeBtn">Analyze Candidate</button>
    <p id="errorMsg" class="error" style="display:none;"></p>

    <div id="results" class="results" style="display:none;">
      <h2>AI Analysis</h2>
      <p><strong>Match Score:</strong> <span class="badge" id="score"></span></p>
      <p><strong>Summary:</strong> <span id="summary"></span></p>
      <p><strong>Recommended Action:</strong> <span id="action"></span></p>
      <p><strong>Reasons for Decision:</strong></p>
      <ul id="reasons"></ul>
      <p><strong>Strengths:</strong></p>
      <ul id="strengths"></ul>
      <p><strong>Gaps:</strong></p>
      <ul id="gaps"></ul>
    </div>
  </div>

  <!-- PDF.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <script>
    const btn = document.getElementById('analyzeBtn');
    const resultsDiv = document.getElementById('results');
    const errorMsg = document.getElementById('errorMsg');

    btn.addEventListener('click', async () => {
      const jd = document.getElementById('jd').value.trim();
      const fileInput = document.getElementById('resumeFile');
      const file = fileInput.files[0];

      if (!jd) {
        showError('Please provide a Job Description.');
        return;
      }
      if (!file || file.type !== 'application/pdf') {
        showError('Please upload a valid PDF resume.');
        return;
      }

      hideError();
      btn.disabled = true;
      btn.innerText = 'Analyzing...';

      try {
        const resumeText = await extractTextFromPDF(file);
        const analysis = analyzeResume(jd, resumeText);
        renderResults(analysis);
      } catch (error) {
        showError('Failed to process PDF. Please try again.');
        console.error(error);
      }

      btn.disabled = false;
      btn.innerText = 'Analyze Candidate';
    });

    async function extractTextFromPDF(file) {
      const arrayBuffer = await file.arrayBuffer();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
      let text = '';
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        text += content.items.map(item => item.str).join(' ') + '\n';
      }
      return text;
    }

    function analyzeResume(jobDescription, resumeText) {
      const jdLower = jobDescription.toLowerCase();
      const resumeLower = resumeText.toLowerCase();

      const jdSkills = extractSkills(jdLower);
      const resumeSkills = extractSkills(resumeLower);

      const matchedSkills = jdSkills.filter(skill => resumeSkills.includes(skill));
      const skillScore = (matchedSkills.length / jdSkills.length) * 60;
      const experienceScore = extractExperience(resumeLower) >= 3 ? 30 : 15;
      const relevanceScore = calculateRelevance(jdLower, resumeLower) * 10;
      const score = Math.min(100, Math.round(skillScore + experienceScore + relevanceScore));

      const strengths = matchedSkills.slice(0, 5);
      const gaps = jdSkills.filter(skill => !resumeSkills.includes(skill)).slice(0, 5);

      let summary = '';
      let action = '';
      let reasons = [];

      if (score >= 80) {
        summary = 'Excellent match with strong alignment in skills and experience.';
        action = 'Interview';
        reasons = [
          'High skill overlap with job requirements.',
          'Sufficient experience level meets or exceeds expectations.',
          'Overall relevance indicates a strong fit for the role.'
        ];
      } else if (score >= 60) {
        summary = 'Good potential, but some gaps in required skills.';
        action = 'Consider for Interview';
        reasons = [
          'Moderate skill alignment, with room for growth.',
          'Experience is adequate but could benefit from more depth.',
          'Potential to bridge gaps through training or additional qualifications.'
        ];
      } else {
        summary = 'Moderate match; significant gaps may require training.';
        action = 'Reject or Hold';
        reasons = [
          'Key skills are missing, such as: ' + gaps.slice(0, 3).join(', ') + (gaps.length > 3 ? ', and others' : '') + '.',
          'Experience level is below the required threshold (less than 3 years detected).',
          'Low overall relevance suggests the candidate may not be ready without substantial upskilling.'
        ];
      }

      return {
        score,
        summary,
        strengths,
        gaps,
        recommended_action: action,
        reasons
      };
    }

    function extractSkills(text) {
      const commonSkills = ['python', 'javascript', 'java', 'aws', 'docker', 'kubernetes', 'sql', 'api', 'react', 'node.js', 'machine learning', 'data analysis'];
      return commonSkills.filter(skill => text.includes(skill));
    }

    function extractExperience(text) {
      const match = text.match(/(\d+)\+?\s*years?/i);
      return match ? parseInt(match[1]) : 0;
    }

    function calculateRelevance(jd, resume) {
      const jdWords = jd.split(/\s+/);
      const resumeWords = resume.split(/\s+/);
      const overlap = jdWords.filter(word => resumeWords.includes(word)).length;
      return Math.min(1, overlap / jdWords.length);
    }

    function renderResults(data) {
      document.getElementById('score').innerText = data.score + '/100';
      document.getElementById('summary').innerText = data.summary;
      document.getElementById('action').innerText = data.recommended_action;

      const reasonsUl = document.getElementById('reasons');
      reasonsUl.innerHTML = '';
      data.reasons.forEach(r => {
        const li = document.createElement('li');
        li.innerText = r;
        reasonsUl.appendChild(li);
      });

      const strengthsUl = document.getElementById('strengths');
      strengthsUl.innerHTML = '';
      data.strengths.forEach(s => {
        const li = document.createElement('li');
        li.innerText = s;
        strengthsUl.appendChild(li);
      });

      const gapsUl = document.getElementById('gaps');
      gapsUl.innerHTML = '';
      data.gaps.forEach(g => {
        const li = document.createElement('li');
        li.innerText = g;
        gapsUl.appendChild(li);
      });

      resultsDiv.style.display = 'block';
    }

    function showError(message) {
      errorMsg.innerText = message;
      errorMsg.style.display = 'block';
    }

    function hideError() {
      errorMsg.style.display = 'none';
    }
  </script>
</body>
</html>
